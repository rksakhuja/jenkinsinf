node {
  environment {
      AWS_ACCESS_KEY_ID     = credentials("$rohit_aws_key")
      AWS_SECRET_ACCESS_KEY = credentials("$rohit_aws_secret")
  }
 stage('checkout') { // for display purposes
    // Get some code from a GitHub repository
    git 'https://github.com/rksakhuja/jenkinsinf'
 }
 stage('Terraform Init') {
  // Run Terraform init command from within specific directory listed in dir command Old:OpsAcademy-Terraform/aws/environment/dev
  dir("main"){
  sh "terraform init"
 }
 }
 stage ('Terraform Apply') {
    withCredentials([string(credentialsId: 'rohit_aws_key', variable: 'AWS_ACCESS_KEY_ID'),
                     string(credentialsId: 'rohit_aws_secret', variable: 'AWS_SECRET_ACCESS_KEY')]) {
      sh """
       export AWS_ACCESS_KEY_ID="$AWS_ACCESS_KEY_ID"
       export AWS_SECRET_ACCESS_KEY="$AWS_SECRET_ACCESS_KEY"
       set +x
       cd main && terraform apply -auto-approve

       """
     }
  }
}